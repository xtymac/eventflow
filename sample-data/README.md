# Sample Data (Nagoya)

These GeoJSON files are demo-only. Coordinates are approximate and centered on well-known Nagoya landmarks.

## Files

| File | Description |
|------|-------------|
| `road_assets.geojson` | Road asset data (24 roads) |
| `road_assets_matched.geojson` | Road assets after OSRM route matching (generated file) |
| `construction_events.geojson` | Construction event data (12 events) |

## Coordinate Reference System

EPSG:4326 (WGS84)

## Road Matching

The `road_assets_matched.geojson` file is generated by the road matching script, which uses the OSRM Route API to snap simplified 2-point road segments to actual OSM road network.

### Running the Script

```bash
cd backend
npm run match-roads
```

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `OSRM_BASE_URL` | `https://router.project-osrm.org` | OSRM server URL (supports local OSRM) |
| `DELAY_MS` | `1000` | Delay between requests (ms) |
| `SNAP_RADIUS` | `50` | Max snap distance (meters) |
| `DETOUR_RATIO` | `3.0` | Max route/straight-line distance ratio |

### Additional Properties (in matched GeoJSON only)

These fields are added by the matching script but NOT stored in the database:

| Property | Type | Description |
|----------|------|-------------|
| `matched` | boolean | Whether routing succeeded |
| `snapDistance` | number | Max distance from original point to snapped road (meters) |
| `detourRatio` | number | Route distance / straight-line distance |
| `originalPointCount` | number | Points in original geometry (usually 2) |
| `matchedPointCount` | number | Points in matched geometry (more points = follows road curves) |

### Match Failure Reasons

Roads may fail to match for several reasons:

1. **API Error (HTTP 400)**: Coordinates are in pedestrian-only areas or unmapped roads
2. **Detour Ratio > 3.0**: Route is too long compared to straight line (likely wrong road)
3. **Snap Distance > 100m**: Original coordinates are too far from any road

Failed roads keep their original 2-point geometry with `matched: false`.

## Data Relationships

- Events reference road assets by `properties.affectedRoadAssetIds`
- Road assets cover wards: Naka-ku, Nakamura-ku, Nishi-ku, Atsuta-ku, Minato-ku, Chikusa-ku, Higashi-ku, and Kita-ku

## Landmarks

Nagoya Station, Nagoya Castle, Sakae/Oasis 21, Atsuta Shrine, Nagoya Port, Vantelin Dome, Osu Kannon, Nagoya Congress Center, Kanayama Station, Shirotori Garden, Nagoya TV Tower, Meijo Park, Nakamura Park, Nagoya University, Garden Pier, Aeon Mall Atsuta, Higashiyama Sky Tower, Fushimi, and Shonai River.
